<Window x:Class="BillManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:models="clr-namespace:BillManager.Models"
        mc:Ignorable="d"
        Title="Bill Manager"
        Height="540"
        Width="760"
        MinWidth="680"
        MinHeight="480"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </Window.Resources>
    <DockPanel>
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_Create Bill" Command="{Binding ResetFormCommand}" />
            <MenuItem Header="_View Last Bill" Command="{Binding ViewLastBillCommand}" />
            <MenuItem Header="E_xit" Command="{Binding ExitCommand}" />
        </Menu>

        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}"
                           TextWrapping="Wrap">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="DarkSlateGray" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsStatusError}" Value="True">
                                    <Setter Property="Foreground" Value="Firebrick" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsStatusError}" Value="False">
                                    <Setter Property="Foreground" Value="ForestGreen" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </StatusBarItem>
        </StatusBar>

        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <Grid Margin="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Row="0"
                           Text="Create Bill"
                           FontSize="20"
                           FontWeight="Bold"
                           Margin="0,0,0,12" />

                <Border Grid.Row="1"
                        Padding="16"
                        Background="#F7F9FC"
                        BorderBrush="#D0DAE7"
                        BorderThickness="1"
                        CornerRadius="8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Grid.Column="0"
                                   Margin="0,0,12,12"
                                   VerticalAlignment="Center"
                                   Text="Description" />
                        <TextBox Grid.Row="0"
                                 Grid.Column="1"
                                 Margin="0,0,0,12"
                                 Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}"
                                 MaxLength="20"
                                 ToolTip="Enter description (3-20 characters)" />

                        <TextBlock Grid.Row="1"
                                   Grid.Column="0"
                                   Margin="0,0,12,12"
                                   VerticalAlignment="Center"
                                   Text="Price" />
                        <TextBox Grid.Row="1"
                                 Grid.Column="1"
                                 Margin="0,0,0,12"
                                 Text="{Binding PriceText, UpdateSourceTrigger=PropertyChanged}"
                                 MaxLength="10"
                                 ToolTip="Enter price greater than 0" />

                        <TextBlock Grid.Row="2"
                                   Grid.Column="0"
                                   Margin="0,0,12,12"
                                   VerticalAlignment="Center"
                                   Text="Items" />
                        <TextBox Grid.Row="2"
                                 Grid.Column="1"
                                 Margin="0,0,0,12"
                                 Text="{Binding ItemsText, UpdateSourceTrigger=PropertyChanged}"
                                 MaxLength="1"
                                 ToolTip="Enter number of items between 0 and 5" />

                        <TextBlock Grid.Row="3"
                                   Grid.Column="0"
                                   Margin="0,0,12,12"
                                   VerticalAlignment="Center"
                                   Text="Filename" />
                        <StackPanel Grid.Row="3"
                                    Grid.Column="1"
                                    Margin="0,0,0,12"
                                    Orientation="Horizontal">
                            <TextBox Width="200"
                                     Text="{Binding Filename, UpdateSourceTrigger=PropertyChanged}"
                                     MaxLength="10"
                                     ToolTip="Enter filename (1-10 characters, alphanumeric or underscore)" />
                            <TextBlock Text="."
                                       Margin="8,0"
                                       VerticalAlignment="Center" />
                            <ComboBox Width="120"
                                      SelectedValuePath="Tag"
                                      SelectedValue="{Binding SelectedFormat}"
                                      VerticalContentAlignment="Center">
                                <ComboBoxItem Tag="{x:Static models:BillFileFormat.Json}">json</ComboBoxItem>
                                <ComboBoxItem Tag="{x:Static models:BillFileFormat.Text}">txt</ComboBoxItem>
                            </ComboBox>
                        </StackPanel>

                        <Button Grid.Row="4"
                                Grid.ColumnSpan="2"
                                Content="Save"
                                Margin="0,12,0,0"
                                Padding="12,6"
                                Background="#2F80ED"
                                Foreground="White"
                                Command="{Binding SaveBillCommand}"
                                HorizontalAlignment="Right"
                                Width="120" />
                    </Grid>
                </Border>

                <Border Grid.Row="2"
                        Margin="0,16,0,0"
                        Padding="12"
                        Background="#FFF5F5"
                        BorderBrush="#F1C0C0"
                        BorderThickness="1"
                        CornerRadius="6"
                        Visibility="{Binding HasValidationMessages, Converter={StaticResource BooleanToVisibilityConverter}, FallbackValue=Collapsed}">
                    <StackPanel>
                        <TextBlock Text="Validation issues detected:"
                                   FontWeight="Bold"
                                   Margin="0,0,0,8"
                                   Foreground="#B00020" />
                        <ItemsControl ItemsSource="{Binding ValidationMessages}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Foreground="#B00020">
                                        <Run Text="â€¢ " FontWeight="Bold" />
                                        <Run Text="{Binding}" />
                                    </TextBlock>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <GroupBox Grid.Row="3"
                          Header="Last Saved Bill"
                          Margin="0,16,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0"
                                   Text="{Binding LastSavedFileSummary}"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,8" />
                        <TextBox Grid.Row="1"
                                 Text="{Binding LastBillDetails, Mode=OneWay}"
                                 IsReadOnly="True"
                                 TextWrapping="Wrap"
                                 VerticalScrollBarVisibility="Auto"
                                 Background="#F8F9FB" />
                    </Grid>
                </GroupBox>
            </Grid>
        </ScrollViewer>
    </DockPanel>
</Window>
